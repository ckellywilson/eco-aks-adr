# Security Policy

## Reporting Security Vulnerabilities

### Template Repository (This Repo)

If you discover a security vulnerability in:
- Prompt templates
- Documentation
- Example configurations
- Workflows

**Please report it via GitHub Security Advisories:**

1. Go to the [Security tab](../../security)
2. Click "Report a vulnerability"
3. Provide detailed information about the vulnerability
4. We will respond within 48 hours

**Do NOT:**
- Open a public issue for security vulnerabilities
- Discuss vulnerabilities in public forums until fixed

### Generated Infrastructure Code (User Repos)

If you discover vulnerabilities in infrastructure code generated by users:
- **Contact the user/organization directly** - This template doesn't contain infrastructure code
- Report to their security team or open a private security advisory in their repository
- The template maintainers are not responsible for security issues in user-generated code

---

## Supported Versions

| Version | Supported          |
| ------- | ------------------ |
| v1.x    | ✅ Yes            |
| < v1.0  | ❌ No             |

We support the latest major version. Users should keep their templates updated.

---

## Security Best Practices

### For Template Maintainers

- ✅ Never commit Azure credentials or secrets
- ✅ Review all PRs for sensitive information
- ✅ Keep Microsoft Docs references up to date
- ✅ Validate all example configurations
- ✅ Use dependabot for GitHub Actions dependencies
- ✅ Enable branch protection on main branch

### For Template Users

After using this template to create your infrastructure repository:

#### Secrets Management
- ✅ Store secrets in Azure Key Vault, not in code
- ✅ Use Managed Identities for Azure authentication
- ✅ Never commit `*.tfstate` files (contains infrastructure state)
- ✅ Never commit `*.tfvars` files with sensitive values
- ✅ Use `.gitignore` to prevent accidental commits
- ✅ Enable Azure Key Vault for Terraform backend

#### Access Control
- ✅ Use Azure RBAC with least privilege principle
- ✅ Enable MFA for Azure accounts
- ✅ Use service principals for CI/CD pipelines
- ✅ Rotate credentials regularly
- ✅ Enable branch protection on main branch
- ✅ Require PR reviews for infrastructure changes

#### Network Security
- ✅ Enable Azure Firewall egress restriction (Scenario 2B)
- ✅ Use private endpoints for Azure services
- ✅ Implement network policies (Cilium recommended)
- ✅ Use Azure DDoS Protection for production
- ✅ Enable NSG flow logs for monitoring

#### AKS Security
- ✅ Use private AKS clusters for production
- ✅ Enable Microsoft Defender for Containers
- ✅ Implement pod security standards
- ✅ Use Azure Policy for governance
- ✅ Enable audit logging
- ✅ Regularly update Kubernetes versions

#### Monitoring
- ✅ Enable Azure Monitor for containers
- ✅ Configure log analytics
- ✅ Set up security alerts
- ✅ Monitor for suspicious activity
- ✅ Enable Azure Security Center

---

## Common Security Issues

### Issue: Terraform State Contains Secrets

**Problem:** Terraform state files may contain sensitive information.

**Solution:**
```hcl
# Use Azure Storage backend with encryption
terraform {
  backend "azurerm" {
    resource_group_name  = "rg-terraform-state"
    storage_account_name = "sttfstate"
    container_name       = "tfstate"
    key                  = "hub.terraform.tfstate"
    
    # Enable encryption
    use_azuread_auth = true
  }
}
```

### Issue: Hardcoded Credentials in tfvars

**Problem:** Passwords or keys in `*.tfvars` files.

**Solution:**
```hcl
# Use data source to fetch from Key Vault
data "azurerm_key_vault_secret" "db_password" {
  name         = "db-password"
  key_vault_id = azurerm_key_vault.main.id
}

resource "azurerm_postgresql_server" "main" {
  administrator_login_password = data.azurerm_key_vault_secret.db_password.value
}
```

### Issue: Overly Permissive Network Rules

**Problem:** NSGs allow `0.0.0.0/0` on all ports.

**Solution:**
- Use egress restriction (Scenario 2B)
- Implement network policies
- Follow least privilege principle
- Review `.github/docs/aks-configuration-decisions.md`

---

## Vulnerability Disclosure Timeline

1. **Report received** - Acknowledged within 48 hours
2. **Initial assessment** - Within 5 business days
3. **Fix development** - Based on severity
   - Critical: 1-7 days
   - High: 7-14 days
   - Medium: 14-30 days
   - Low: 30-90 days
4. **Release** - Fix included in next release
5. **Public disclosure** - 30 days after fix release

---

## Security Updates

Template updates include:
- Security advisories
- Updated best practices
- Microsoft security recommendations
- Dependency updates

**Stay Updated:**
```bash
# Add template as remote
git remote add template https://github.com/YOUR-ORG/aks-lz-ghcp.git

# Check for updates
git fetch template

# Sync security updates
git checkout template/main -- .github/
```

Or enable the `.github/workflows/sync-prompts.yml` workflow for automatic updates.

---

## Related Security Resources

### Microsoft Security Documentation
- [AKS Security Best Practices](https://learn.microsoft.com/azure/aks/operator-best-practices-cluster-security)
- [Azure Security Baseline for AKS](https://learn.microsoft.com/security/benchmark/azure/baselines/aks-security-baseline)
- [Container Security in Azure](https://learn.microsoft.com/azure/container-instances/container-instances-image-security)

### Azure Services
- [Microsoft Defender for Containers](https://learn.microsoft.com/azure/defender-for-cloud/defender-for-containers-introduction)
- [Azure Key Vault](https://learn.microsoft.com/azure/key-vault/)
- [Azure Private Link](https://learn.microsoft.com/azure/private-link/)

### Compliance
- [Azure Compliance](https://learn.microsoft.com/azure/compliance/)
- [AKS and Compliance](https://learn.microsoft.com/azure/aks/concepts-security#compliance)

---

## Contact

- **Security Issues**: Use GitHub Security Advisories (see above)
- **General Questions**: Open a GitHub issue
- **Urgent Security Matters**: Contact repository maintainers directly

---

**Thank you for helping keep this template and the infrastructure it generates secure!**
