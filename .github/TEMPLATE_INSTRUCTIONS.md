# ğŸ‰ Welcome to Your AKS Infrastructure Repository!

You've successfully created a new repository from the **AKS Landing Zone - GitHub Copilot Prompt Template**.

This file contains instructions for getting started. **Delete this file after reading** (or keep it for reference).

---

## âœ… Next Steps

### 1. Verify Repository Setup

Ensure your repository is properly configured:

```bash
# Check that you're in your repo (not the template)
git remote -v
# Should show YOUR repository, not the template repo

# Verify the .github directory is present
ls -la .github/
```

### 2. Complete Configuration Decisions (REQUIRED)

**Before generating any code**, complete the decision guides:

```bash
# Open and complete ALL sections (REQUIRED)
code .github/docs/aks-configuration-decisions.md

# Review deployment scenarios
code .github/docs/deployment-scenarios.md

# Review example configurations
ls .github/examples/
```

**ğŸš¨ Do NOT skip step 2!** The prompts require these decisions.

### 3. Generate Hub Infrastructure

```bash
# Open the hub prompt
code .github/prompts/hub-landing-zone.prompt.md

# Ask GitHub Copilot in Chat:
# "Implement this hub landing zone prompt"

# Copilot will generate Terraform code in hub/ directory
```

### 4. Generate Spoke Infrastructure

```bash
# Open the spoke prompt
code .github/prompts/spoke-aks.prompt.md

# Replace ALL [DECISION REQUIRED] placeholders with your selections
# from aks-configuration-decisions.md

# Ask GitHub Copilot:
# "Implement this spoke AKS prompt with my configuration decisions"

# Copilot will generate Terraform code in spoke-aks/ directory
```

### 5. Deploy Infrastructure

```bash
# Deploy hub
cd hub
terraform init
terraform plan
terraform apply

# Deploy spoke
cd ../spoke-aks
terraform init
terraform plan
terraform apply
```

### 6. Validate Deployment

```bash
# Follow the validation guide
code .github/demos/egress-restriction-demo.md

# Test egress restrictions (if enabled)
kubectl run test --image=nicolaka/netshoot -it --rm
```

---

## ğŸ“ Expected Repository Structure

After generating code, your repository should look like:

```
my-aks-infrastructure/          # Your repository
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ prompts/                # Copilot prompts (from template)
â”‚   â”œâ”€â”€ docs/                   # Decision guides (from template)
â”‚   â”œâ”€â”€ examples/               # Example configs (from template)
â”‚   â”œâ”€â”€ instructions/           # Copilot rules (from template)
â”‚   â””â”€â”€ demos/                  # Validation guides (from template)
â”œâ”€â”€ hub/                        # Generated by Copilot
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â””â”€â”€ environments/
â”‚       â”œâ”€â”€ dev.tfvars
â”‚       â””â”€â”€ prod.tfvars
â”œâ”€â”€ spoke-aks/                  # Generated by Copilot
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â””â”€â”€ environments/
â”‚       â”œâ”€â”€ dev.tfvars
â”‚       â””â”€â”€ prod.tfvars
â”œâ”€â”€ README.md                   # Update with YOUR project details
â””â”€â”€ .gitignore                  # Already configured
```

---

## ğŸ”„ Syncing Prompt Updates from Template (Optional)

The template repository is regularly updated with latest Azure best practices. To pull updates:

### Option 1: Manual Sync

```bash
# Add template as remote (one-time setup)
git remote add template https://github.com/YOUR-ORG/aks-lz-ghcp.git
git fetch template

# Pull latest prompt updates (keep your generated code)
git checkout template/main -- .github/prompts
git checkout template/main -- .github/docs
git checkout template/main -- .github/instructions
git checkout template/main -- .github/examples

# Commit updates
git add .github/
git commit -m "chore: sync prompts from template v1.1.0"
git push
```

### Option 2: Automated Sync (GitHub Action)

Enable the sync workflow:

```bash
# Edit the workflow file
code .github/workflows/sync-prompts.yml

# Uncomment the workflow triggers
# Push changes
git add .github/workflows/sync-prompts.yml
git commit -m "feat: enable prompt sync workflow"
git push
```

The workflow will check for template updates weekly (configurable).

---

## ğŸ“ Customize Your Repository

### Update README.md

Replace the template README with your project details:

```bash
code README.md
```

Include:
- Your project name and description
- Your organization's specific requirements
- Your deployment instructions
- Your team contacts
- Your environment naming conventions

### Add Your .tfvars Files

Create environment-specific configurations:

```bash
# Hub environments
mkdir -p hub/environments
cp .github/examples/prod-egress-restricted.tfvars hub/environments/prod.tfvars
# Edit with your values

# Spoke environments
mkdir -p spoke-aks/environments
cp .github/examples/prod-egress-restricted.tfvars spoke-aks/environments/prod.tfvars
# Edit with your values
```

### Configure Azure Backend (Recommended)

For production, use Azure Storage for Terraform state:

```hcl
# hub/backend.tf
terraform {
  backend "azurerm" {
    resource_group_name  = "rg-terraform-state"
    storage_account_name = "sttfstateYOURORG"
    container_name       = "tfstate"
    key                  = "hub.terraform.tfstate"
  }
}
```

---

## ğŸ›¡ï¸ Security Best Practices

### Protect Sensitive Files

Ensure these are in `.gitignore` (already configured):
- âœ… `*.tfstate` - Terraform state (may contain secrets)
- âœ… `*.tfvars` - May contain passwords/keys
- âœ… `.terraform/` - Downloaded providers
- âœ… `*.pem`, `*.key` - Certificates and keys

### Use Azure Key Vault

Store secrets in Azure Key Vault, not in code:

```hcl
data "azurerm_key_vault_secret" "example" {
  name         = "db-password"
  key_vault_id = azurerm_key_vault.main.id
}
```

### Enable Branch Protection

Configure in GitHub Settings â†’ Branches:
- âœ… Require pull request reviews
- âœ… Require status checks (Terraform plan)
- âœ… Restrict who can push to main
- âœ… Require signed commits

---

## ğŸ§ª Testing Your Configuration

### Validate Terraform Syntax

```bash
terraform fmt -check -recursive
terraform validate
```

### Plan Before Apply

```bash
terraform plan -out=plan.out
# Review the plan carefully
terraform show plan.out
# If looks good:
terraform apply plan.out
```

### Test Network Policies

After deployment, validate egress restrictions:

```bash
code .github/demos/egress-restriction-demo.md
```

---

## ğŸ“š Additional Resources

### Official Documentation
- [AKS Documentation](https://learn.microsoft.com/azure/aks/)
- [AKS Baseline Architecture](https://learn.microsoft.com/azure/architecture/reference-architectures/containers/aks/baseline-aks)
- [Azure Verified Modules](https://aka.ms/avm)
- [Terraform AzureRM Provider](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs)

### Template Repository
- [Template Repo (for updates)](https://github.com/ckellywilson/aks-lz-ghcp)
- [Report Template Issues](https://github.com/ckellywilson/aks-lz-ghcp/issues)

### Community
- [Microsoft Q&A - AKS](https://learn.microsoft.com/answers/topics/azure-kubernetes-service.html)
- [Azure Support](https://azure.microsoft.com/support/options/)

---

## âœ… Post-Setup Checklist

Before you start working, verify:

- [ ] Completed `.github/docs/aks-configuration-decisions.md`
- [ ] Reviewed `.github/docs/deployment-scenarios.md`
- [ ] Reviewed example configs in `.github/examples/`
- [ ] Updated `README.md` with your project details
- [ ] Configured Azure backend for Terraform state
- [ ] Added branch protection rules
- [ ] **Generated CI/CD pipelines** (use: "Generate CI/CD pipelines" prompt)
  - [ ] GitHub Actions (`.github/workflows/`) OR
  - [ ] Azure DevOps Pipelines (`.azdo/pipelines/`)
- [ ] Set up Azure credentials for deployment (OIDC or Service Principal)
- [ ] Configured environments with approval gates (dev, prod)
- [ ] Configured team access to repository
- [ ] **Deleted this file** (TEMPLATE_INSTRUCTIONS.md) â† Do this now!

---

## ğŸ¯ You're Ready!

Everything is set up. Now you can:

1. Complete your configuration decisions
2. Generate infrastructure code with GitHub Copilot
3. Deploy to Azure
4. Validate with the demos

**Delete this file and start building!** ğŸš€

```bash
rm .github/TEMPLATE_INSTRUCTIONS.md
git add .github/TEMPLATE_INSTRUCTIONS.md
git commit -m "chore: remove template instructions"
git push
```

---

**Questions?** Check the documentation in `.github/docs/` or open an issue in the template repository.

Good luck with your AKS deployment! ğŸ‰
