{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "2.0",
  "description": "Customer configuration schema for AKS Landing Zone with DNS Resolver and Private DNS Zone Groups",
  "lastUpdated": "2026-02-04",
  "hub": {
    "firewall": true,
    "bastion": true,
    "applicationGateway": false,
    "dnsResolver": {
      "enabled": true,
      "inboundSubnet": "10.0.6.0/28",
      "outboundSubnet": "10.0.7.0/28",
      "inboundEndpointIp": "10.0.6.4",
      "forwardingRules": {
        "enabled": true,
        "onPremDomain": "corp.ecolab.com",
        "onPremDnsServers": []
      }
    },
    "privateDnsZones": [
      "privatelink.eastus2.azmk8s.io",
      "privatelink.azurecr.io",
      "privatelink.vaultcore.azure.net",
      "privatelink.blob.core.windows.net",
      "privatelink.file.core.windows.net",
      "privatelink.queue.core.windows.net",
      "privatelink.table.core.windows.net",
      "privatelink.monitor.azure.com",
      "privatelink.oms.opinsights.azure.com",
      "privatelink.ods.opinsights.azure.com",
      "privatelink.agentsvc.azure-automation.net"
    ],
    "vnetPeering": {
      "enabled": true,
      "spokes": {
        "aks-prod": {
          "name": "vnet-spoke-aks-eus2-prod",
          "resourceGroup": "rg-spoke-aks-eus2-prod",
          "addressSpace": ["10.1.0.0/16"]
        }
      }
    },
    "jumpBox": {
      "enabled": true,
      "vmSize": "Standard_D2s_v3",
      "osType": "Ubuntu",
      "osVersion": "22.04-lts",
      "subnet": "management"
    },
    "firewallRules": {
      "aksApplicationRules": [
        {
          "name": "aks-api-server",
          "targetFqdns": ["*.hcp.eastus2.azmk8s.io"],
          "protocols": ["https:443"]
        },
        {
          "name": "microsoft-container-registry",
          "targetFqdns": ["mcr.microsoft.com", "*.data.mcr.microsoft.com"],
          "protocols": ["https:443"]
        },
        {
          "name": "azure-monitor",
          "targetFqdns": ["*.ods.opinsights.azure.com", "*.oms.opinsights.azure.com", "*.monitoring.azure.com"],
          "protocols": ["https:443"]
        },
        {
          "name": "azure-container-registry",
          "targetFqdns": ["*.azurecr.io"],
          "protocols": ["https:443"]
        }
      ],
      "aksNetworkRules": [
        {
          "name": "dns",
          "protocols": ["UDP", "TCP"],
          "destinationPorts": ["53"]
        },
        {
          "name": "ntp",
          "protocols": ["UDP"],
          "destinationPorts": ["123"]
        },
        {
          "name": "https",
          "protocols": ["TCP"],
          "destinationPorts": ["443"]
        }
      ]
    },
    "location": "eastus2",
    "environment": "prod",
    "enableSecurityCenter": true,
    "enableSentinel": false,
    "tags": {
      "Environment": "Production",
      "ManagedBy": "Terraform",
      "Purpose": "AKS Landing Zone Hub",
      "Version": "2.0"
    }
  },
  "spoke": {
    "scenario": "Model B - Platform team provisions RG, VNet, Route Table",
    "networkPlugin": "azure",
    "networkPluginMode": "overlay",
    "networkDataplane": "cilium",
    "networkPolicy": "cilium",
    "outboundType": "userDefinedRouting",
    "privateCluster": true,
    "podCidr": "192.168.0.0/16",
    "serviceCidr": "172.16.0.0/16",
    "dnsServiceIp": "172.16.0.10",
    "ingressMethod": "none",
    "vnetDnsServers": {
      "useHubDnsResolver": true,
      "dnsResolverIp": "10.0.6.4"
    },
    "privateEndpoints": {
      "acr": {
        "enabled": true,
        "subnet": "management",
        "dnsZoneGroup": {
          "enabled": true,
          "privateDnsZoneId": "hub.privateDnsZones.privatelink.azurecr.io"
        }
      },
      "keyVault": {
        "enabled": true,
        "subnet": "management",
        "dnsZoneGroup": {
          "enabled": true,
          "privateDnsZoneId": "hub.privateDnsZones.privatelink.vaultcore.azure.net"
        }
      },
      "aksApi": {
        "enabled": true,
        "subnet": "aks_nodes",
        "dnsZoneGroup": {
          "enabled": true,
          "privateDnsZoneId": "hub.privateDnsZones.privatelink.eastus2.azmk8s.io"
        }
      }
    },
    "acr": {
      "enabled": true,
      "sku": "Premium",
      "privateEndpoint": true,
      "kubeletIdentityRole": "AcrPull"
    },
    "keyVault": {
      "enabled": true,
      "sku": "standard",
      "privateEndpoint": true,
      "rbacAuthorization": true,
      "controlPlaneIdentityRole": "Key Vault Secrets User",
      "purgeProtection": true,
      "softDeleteRetentionDays": 7
    },
    "jumpBox": {
      "enabled": true,
      "vmSize": "Standard_D2s_v3",
      "osType": "Ubuntu",
      "osVersion": "22.04-lts",
      "subnet": "management",
      "aksClusterUserRole": true
    },
    "diagnosticSettings": {
      "enabled": true,
      "logAnalyticsWorkspaceId": "hub.logAnalyticsWorkspaceId",
      "logs": [
        "kube-apiserver",
        "kube-controller-manager",
        "kube-scheduler",
        "kube-audit",
        "cluster-autoscaler"
      ],
      "metrics": ["AllMetrics"]
    },
    "nodePoolsConfiguration": {
      "system": {
        "vmSize": "Standard_D4s_v3",
        "nodeCount": 2,
        "enableAutoScaling": false,
        "enableHostEncryption": true,
        "osDiskSizeGB": 30,
        "mode": "System"
      },
      "user": {
        "vmSize": "Standard_D4s_v3",
        "nodeCount": 2,
        "enableAutoScaling": false,
        "osDiskSizeGB": 30,
        "mode": "User"
      }
    },
    "createResourceGroup": false,
    "existingResourceGroupName": "rg-spoke-aks-eus2-prod",
    "createVirtualNetwork": false,
    "existingVirtualNetworkName": "vnet-spoke-aks-eus2-prod",
    "createSubnets": false,
    "createVnetPeering": false,
    "createRouteTable": false,
    "enableEgressRestriction": true,
    "egressSecurityLevel": "strict",
    "enableEncryptionAtHost": true,
    "enableDefender": true,
    "location": "eastus2",
    "environment": "prod",
    "kubernetesVersion": "1.30",
    "skuTier": "Standard",
    "tags": {
      "Environment": "Production",
      "ManagedBy": "Terraform",
      "Purpose": "AKS Spoke - Production",
      "Version": "2.0"
    }
  },
  "documentation": {
    "references": [
      {
        "title": "Azure Private DNS Resolver",
        "url": "https://learn.microsoft.com/azure/dns/dns-private-resolver-overview",
        "description": "Hub DNS Resolver enables spoke VNets to resolve Private DNS zones and on-premises domains"
      },
      {
        "title": "Private Endpoint DNS Integration",
        "url": "https://learn.microsoft.com/azure/private-link/private-endpoint-dns",
        "description": "DNS Zone Groups automatically register A records for private endpoints without spoke VNet links"
      },
      {
        "title": "Azure CNI Overlay",
        "url": "https://learn.microsoft.com/azure/aks/azure-cni-overlay",
        "description": "Azure CNI Overlay mode provides IP-efficient pod networking with 10x more pods per node"
      },
      {
        "title": "Azure CNI Powered by Cilium",
        "url": "https://learn.microsoft.com/azure/aks/azure-cni-powered-by-cilium",
        "description": "Cilium dataplane provides eBPF-based networking with L7 policies and high performance"
      },
      {
        "title": "Azure Verified Modules",
        "url": "https://aka.ms/avm",
        "description": "Infrastructure code follows AVM patterns for consistency and best practices"
      }
    ],
    "implementationNotes": [
      "Hub VNet is linked to all Private DNS zones",
      "Spoke VNets use hub DNS Resolver (10.0.6.4) for DNS queries",
      "Private endpoints use DNS Zone Groups for automatic A record registration",
      "No spoke VNet links to Private DNS zones are required",
      "VNet peering is managed from hub side (bidirectional)",
      "Azure Firewall rules allow AKS dependencies",
      "All resources deployed using Azure Verified Modules (AVM)",
      "Host-based encryption enabled on AKS node pools"
    ],
    "validationScripts": [
      {
        "name": "validate-deployment.sh",
        "purpose": "Validates hub and spoke infrastructure deployment",
        "location": "scripts/validate-deployment.sh"
      },
      {
        "name": "validate-networking.sh",
        "purpose": "Validates network connectivity and DNS from within AKS cluster",
        "location": "scripts/validate-networking.sh"
      }
    ]
  }
}
